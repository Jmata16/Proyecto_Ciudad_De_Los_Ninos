@{
    var rifas = ViewBag.Rifas as IEnumerable<Proyecto_Ciudad_De_Los_Ninos.Models.Rifa>;
}

<h2>Detalles de las Rifas</h2>

<table class="table">
    <thead>
        <tr>
            <th>Fecha de la Rifa</th>
            <th>Premio</th>
            <th>Número Ganador</th>
            <th>Tiempo Restante</th>
        </tr>
    </thead>
    <tbody>
        @if (rifas != null && rifas.Any())
        {
            foreach (var rifa in rifas)
            {
                <tr>
                    <td>@rifa.FechaRifa.ToString("dd/MM/yyyy HH:mm:ss")</td>
                    <td>@rifa.Premio</td>
                    <td>
                        @(rifa.NumeroGanador.HasValue
                            ? rifa.NumeroGanador.Value.ToString()
                            : "No determinado")
                    </td>
                    <td>
                        @if (rifa.FechaRifa > DateTime.Now)
                        {
                            <span id="tiempo-restante-@rifa.RifaId" data-fecha="@rifa.FechaRifa.ToString("o")"></span>
                            <script>
                                (function () {
                                    var countdownElement = document.getElementById("tiempo-restante-@rifa.RifaId");
                                    var fechaRifa = new Date(countdownElement.dataset.fecha);
                                    var interval = setInterval(function () {
                                        var now = new Date();
                                        var tiempoRestante = fechaRifa - now;

                                        if (tiempoRestante > 0) {
                                            var days = Math.floor(tiempoRestante / (1000 * 60 * 60 * 24));
                                            var hours = Math.floor((tiempoRestante % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                            var minutes = Math.floor((tiempoRestante % (1000 * 60 * 60)) / (1000 * 60));
                                            countdownElement.innerHTML = `${days} días, ${hours} horas, ${minutes} minutos`;
                                        } else {
                                            clearInterval(interval);
                                            countdownElement.innerHTML = "Tiempo terminado, el ganador se anunciará pronto...";
                                            // Aquí puedes realizar una petición al servidor para verificar el ganador
                                        }
                                    }, 1000);
                                })();
                            </script>
                        }
                        else
                        {
                            <span>Rifa pasada</span>
                        }
                    </td>

                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="4">No hay rifas disponibles.</td>
            </tr>
        }
    </tbody>
</table>
